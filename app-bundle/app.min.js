(()=>{var e={505:()=>{process.on("SIGINT",(function(e){process.exit()})),process.on("exit",(function(e){console.log("\nServer is stoped")}))},5:e=>{e.exports={uuid_valid:function(e){return!![/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1][0-9a-fA-F]{3}-[89AB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/gi,/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[2][0-9a-fA-F]{3}-[89AB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/gi,/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[3][0-9a-fA-F]{3}-[89AB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/gi,/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[4][0-9a-fA-F]{3}-[89AB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/gi,/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[5][0-9a-fA-F]{3}-[89AB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/gi].find((function(s){return!0===s.test(e)}))},validate_post_data:function(e){try{var s=JSON.parse(e);if("number"==typeof s.age&&"string"==typeof s.username&&Array.isArray(s.hobbies)&&!s.hobbies.find((function(e){return"string"!=typeof e})))return s;process.stdout.write("Status: 400\nError validate request body. Check for required fields\n");return{statusCode:400,message:"Error validate request body. Check for required fields"}}catch(e){process.stdout.write("Status: 400\n"+e.message+"\n");var t={statusCode:400,message:e.message};throw new Error(JSON.stringify(t))}}}},738:(e,s,t)=>{const r=t(147),n=t(17),o=t(37),i=t(968).version,a=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function u(e){console.log(`[dotenv@${i}][DEBUG] ${e}`)}const d={config:function(e){let s=n.resolve(process.cwd(),".env"),t="utf8";const i=Boolean(e&&e.debug),a=Boolean(e&&e.override);var c;e&&(null!=e.path&&(s="~"===(c=e.path)[0]?n.join(o.homedir(),c.slice(1)):c),null!=e.encoding&&(t=e.encoding));try{const e=d.parse(r.readFileSync(s,{encoding:t}));return Object.keys(e).forEach((function(s){Object.prototype.hasOwnProperty.call(process.env,s)?(!0===a&&(process.env[s]=e[s]),i&&u(!0===a?`"${s}" is already defined in \`process.env\` and WAS overwritten`:`"${s}" is already defined in \`process.env\` and was NOT overwritten`)):process.env[s]=e[s]})),{parsed:e}}catch(e){return i&&u(`Failed to load ${s} ${e.message}`),{error:e}}},parse:function(e){const s={};let t,r=e.toString();for(r=r.replace(/\r\n?/gm,"\n");null!=(t=a.exec(r));){const e=t[1];let r=t[2]||"";r=r.trim();const n=r[0];r=r.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===n&&(r=r.replace(/\\n/g,"\n"),r=r.replace(/\\r/g,"\r")),s[e]=r}return s}};e.exports.config=d.config,e.exports.parse=d.parse,e.exports=d},113:e=>{"use strict";e.exports=require("crypto")},147:e=>{"use strict";e.exports=require("fs")},685:e=>{"use strict";e.exports=require("http")},492:e=>{"use strict";e.exports=require("node:stream")},37:e=>{"use strict";e.exports=require("os")},17:e=>{"use strict";e.exports=require("path")},968:e=>{"use strict";e.exports=JSON.parse('{"name":"dotenv","version":"16.0.3","description":"Loads environment variables from .env file","main":"lib/main.js","types":"lib/main.d.ts","exports":{".":{"require":"./lib/main.js","types":"./lib/main.d.ts","default":"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},"scripts":{"dts-check":"tsc --project tests/types/tsconfig.json","lint":"standard","lint-readme":"standard-markdown","pretest":"npm run lint && npm run dts-check","test":"tap tests/*.js --100 -Rspec","prerelease":"npm test","release":"standard-version"},"repository":{"type":"git","url":"git://github.com/motdotla/dotenv.git"},"keywords":["dotenv","env",".env","environment","variables","config","settings"],"readmeFilename":"README.md","license":"BSD-2-Clause","devDependencies":{"@types/node":"^17.0.9","decache":"^4.6.1","dtslint":"^3.7.0","sinon":"^12.0.1","standard":"^16.0.4","standard-markdown":"^7.1.0","standard-version":"^9.3.2","tap":"^15.1.6","tar":"^6.1.11","typescript":"^4.5.4"},"engines":{"node":">=12"}}')}},s={};function t(r){var n=s[r];if(void 0!==n)return n.exports;var o=s[r]={exports:{}};return e[r](o,o.exports,t),o.exports}(()=>{t(505);var e=t(685),s=t(492).finished,r=(t(738).config(),t(113).randomUUID),n=t(5),o=n.uuid_valid,i=n.validate_post_data,a=process.env.PORT||null;null===a&&(console.log("\nNot set port or not found .env file"),process.exit());var u=[];e.createServer((function(e,t){process.stdout.write("\nMethod: "+e.method+"\nRequest URL: "+e.url+"\n"),t.setHeader("Content-Type","application/json");try{switch(!0){case"/api/users"===e.url&&("GET"===e.method||"HEAD"===e.method):c(e,t);break;case"/api/users"===e.url&&"POST"===e.method:p(e,t);break;case!e.url.match("/api/users/[a-zA-Z0-9-]+$")?null:"GET"===e.method||"HEAD"===e.method:f(e,t);break;case!e.url.match("/api/users/[a-zA-Z0-9-]+$")?null:"PUT"===e.method:l(e,t);break;case!e.url.match("/api/users/[a-zA-Z0-9-]+$")?null:"DELETE"===e.method:g(e,t);break;default:d(t)}}catch(e){t.writeHead(JSON.parse(e.message).statusCode),t.write(e.message),t.end("\n")}s(e,(function(e){e&&console.log(e)})),s(t,(function(e){e&&console.log(e)}))})).listen(a,"127.0.0.1",(function(){console.log("Start http server!"),console.log("Сервер начал прослушивание запросов на порту "+a)}));var d=function(e){process.stdout.write("Status: 404\nResponse: endpoints not found\n");throw new Error(JSON.stringify({statusCode:404,message:"Uri api http not found"}))},c=function(e,s){process.stdout.write("Status: 200\nResponse: request success\n"),s.statusCode=200,s.write(JSON.stringify(u)+"\n"),s.end()},p=function(e,s){var t="";e.on("data",(function(e){t+=e.toString()})),e.on("end",(function(){try{var e=i(t);if(e.statusCode)throw new Error(JSON.stringify(e));e.uuid=r(),u.push(e),process.stdout.write("Status: 201\nResponse: create user success\n"),s.writeHead(201),s.write(JSON.stringify(e)),s.end("\n")}catch(e){s.writeHead(JSON.parse(e.message).statusCode),s.write(e.message),s.end()}}))},f=function(e,s){var t=e.url.split("/").slice(-1).join();if(!o(t)){process.stdout.write("Status: 400\nResponse: in valid uuid\n");throw new Error(JSON.stringify({statusCode:400,message:"Get parametr uuid not valid"}))}var r=u.find((function(e){return e.uuid===t}));if(!r){process.stdout.write("Status: 404\nResponse: not found user\n");throw new Error(JSON.stringify({statusCode:404,message:"Not found users is get UUID"}))}process.stdout.write("Status: 200\nResponse: get user success\n"),s.writeHead(200),s.write(JSON.stringify(r)),s.end("\n")},l=function(e,s){var t="";e.on("data",(function(e){t+=e.toString()})),e.on("end",(function(){try{var r=i(t);if(r.statusCode)throw new Error(JSON.stringify(r));var n=e.url.split("/").slice(-1).join();if(!o(n)){process.stdout.write("Status: 400\nResponse: in valid uuid\n");throw new Error(JSON.stringify({statusCode:400,message:"Get parametr uuid not valid"}))}var a=u.findIndex((function(e){return e.uuid===n}));if(-1==a){process.stdout.write("Status: 404\nResponse: not found user\n");throw new Error(JSON.stringify({statusCode:404,message:"Not found users is get UUID"}))}if(r.uuid=n,!(u.splice(a,1,r).length>0)){process.stdout.write("Status: 400\nResponse: change user fail\n");throw new Error(JSON.stringify({statusCode:400,message:"Change user data fail!"}))}process.stdout.write("Status: 200\nResponse: change user success\n"),s.writeHead(200),s.write(JSON.stringify(r)),s.end("\n")}catch(e){s.writeHead(JSON.parse(e.message).statusCode),s.write(e.message),s.end()}}))},g=function e(s,t){var r=s.url.split("/").slice(-1).join();if(!o(r)){process.stdout.write("Status: 400\nResponse: in valid uuid\n");throw new Error(JSON.stringify({statusCode:400,message:"Get parametr uuid not valid"}))}var n=u.findIndex((function(e){return e.uuid===r}));if(-1==n){process.stdout.write("Status: 404\nResponse: not found user\n");throw new Error(JSON.stringify({statusCode:404,message:"Not found users is get UUID"}))}u.splice(n,1);if(!(e.length>0)){process.stdout.write("Status: 400\nResponse: delete user fail\n");throw new Error(JSON.stringify({statusCode:400,message:"Delete user data fail!"}))}process.stdout.write("Status: 204\nResponse: delete user success\n"),t.writeHead(204),t.end()}})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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L2FwcC92YWxpZGF0ZXMuanMiLCJ3ZWJwYWNrOi8vc2ltcGxlLWFwaS8uL25vZGVfbW9kdWxlcy9kb3RlbnYvbGliL21haW4uanMiLCJ3ZWJwYWNrOi8vc2ltcGxlLWFwaS9leHRlcm5hbCBub2RlLWNvbW1vbmpzIFwiY3J5cHRvXCIiLCJ3ZWJwYWNrOi8vc2ltcGxlLWFwaS9leHRlcm5hbCBub2RlLWNvbW1vbmpzIFwiZnNcIiIsIndlYnBhY2s6Ly9zaW1wbGUtYXBpL2V4dGVybmFsIG5vZGUtY29tbW9uanMgXCJodHRwXCIiLCJ3ZWJwYWNrOi8vc2ltcGxlLWFwaS9leHRlcm5hbCBub2RlLWNvbW1vbmpzIFwibm9kZTpzdHJlYW1cIiIsIndlYnBhY2s6Ly9zaW1wbGUtYXBpL2V4dGVybmFsIG5vZGUtY29tbW9uanMgXCJvc1wiIiwid2VicGFjazovL3NpbXBsZS1hcGkvZXh0ZXJuYWwgbm9kZS1jb21tb25qcyBcInBhdGhcIiIsIndlYnBhY2s6Ly9zaW1wbGUtYXBpL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3NpbXBsZS1hcGkvLi9hcHAvYXBwLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGhhbmRsZXIgY3RybCtjXG5wcm9jZXNzLm9uKFwiU0lHSU5UXCIsIChkYXRhKSA9PiB7XG4gICAgcHJvY2Vzcy5leGl0KCk7XG59KTtcbnByb2Nlc3Mub24gKFwiZXhpdFwiLCAoZGF0YSk9PiB7XG4gICAgY29uc29sZS5sb2coXCJcXG5TZXJ2ZXIgaXMgc3RvcGVkXCIpO1xufSkiLCJjb25zdCB1dWlkX3ZhbGlkID0gKGRhdGEpID0+IHtcbiAgICAvLyBSZWd1bGFyIGV4cHJlc3Npb24gdG8gY2hlY2sgaWYgc3RyaW5nIGlzIGEgdmFsaWQgVVVJRFxuICAgICAgICAgICAgY29uc3QgcmVnZXhFeHAgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAvXlswLTlhLWZBLUZdezh9LVswLTlhLWZBLUZdezR9LVsxXVswLTlhLWZBLUZdezN9LVs4OUFCXVswLTlhLWZBLUZdezN9LVswLTlhLWZBLUZdezEyfSQvZ2ksXG4gICAgICAgICAgICAgICAgICAgICAgICAvXlswLTlhLWZBLUZdezh9LVswLTlhLWZBLUZdezR9LVsyXVswLTlhLWZBLUZdezN9LVs4OUFCXVswLTlhLWZBLUZdezN9LVswLTlhLWZBLUZdezEyfSQvZ2ksXG4gICAgICAgICAgICAgICAgICAgICAgICAvXlswLTlhLWZBLUZdezh9LVswLTlhLWZBLUZdezR9LVszXVswLTlhLWZBLUZdezN9LVs4OUFCXVswLTlhLWZBLUZdezN9LVswLTlhLWZBLUZdezEyfSQvZ2ksXG4gICAgICAgICAgICAgICAgICAgICAgICAvXlswLTlhLWZBLUZdezh9LVswLTlhLWZBLUZdezR9LVs0XVswLTlhLWZBLUZdezN9LVs4OUFCXVswLTlhLWZBLUZdezN9LVswLTlhLWZBLUZdezEyfSQvZ2ksXG4gICAgICAgICAgICAgICAgICAgICAgICAvXlswLTlhLWZBLUZdezh9LVswLTlhLWZBLUZdezR9LVs1XVswLTlhLWZBLUZdezN9LVs4OUFCXVswLTlhLWZBLUZdezN9LVswLTlhLWZBLUZdezEyfSQvZ2ksXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgLy8gZmluZCBpbiBhcnJheSBcbiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZCA9IHJlZ2V4RXhwLmZpbmQoIGl0ZW0gPT4gaXRlbS50ZXN0KGRhdGEpID09PSB0cnVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHZhbGlkKT90cnVlOmZhbHNlO1xufVxuXG4vLyBoYW5kbGVyIG5vdCB2YWxpZGF0ZSBwb3N0IHJlcXVlc3RcbmNvbnN0IHZhbGlkYXRlX3Bvc3RfZGF0YSA9IChib2R5KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoYm9keSk7XG4gICAgICAgIGlmKHR5cGVvZiBkYXRhLmFnZSA9PT0gJ251bWJlcicgJiYgdHlwZW9mIGRhdGEudXNlcm5hbWUgPT09ICdzdHJpbmcnICYmIEFycmF5LmlzQXJyYXkoZGF0YS5ob2JiaWVzKSkge1xuICAgICAgICAgICAgLy8gY2hlY2sgYXJyYXkgb25seSBzdHJpbmcgdHlwZSBpdGVtXG4gICAgICAgICAgICBpZiAoIWRhdGEuaG9iYmllcy5maW5kKCBpdGVtID0+IHR5cGVvZiBpdGVtICE9PSAnc3RyaW5nJykpe1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKFwiU3RhdHVzOiA0MDBcXG5FcnJvciB2YWxpZGF0ZSByZXF1ZXN0IGJvZHkuIENoZWNrIGZvciByZXF1aXJlZCBmaWVsZHNcXG5cIik7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IHtcbiAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiA0MDAsIFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRXJyb3IgdmFsaWRhdGUgcmVxdWVzdCBib2R5LiBDaGVjayBmb3IgcmVxdWlyZWQgZmllbGRzXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVycm9yO1xuICAgIH1jYXRjaCAoZSkge1xuICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShcIlN0YXR1czogNDAwXFxuXCIrZS5tZXNzYWdlK1wiXFxuXCIpO1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSB7XG4gICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogNDAwLCBcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKEpTT04uc3RyaW5naWZ5KGVycm9yKSk7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7IHV1aWRfdmFsaWQsIHZhbGlkYXRlX3Bvc3RfZGF0YSB9OyIsImNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKVxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKVxuY29uc3Qgb3MgPSByZXF1aXJlKCdvcycpXG5jb25zdCBwYWNrYWdlSnNvbiA9IHJlcXVpcmUoJy4uL3BhY2thZ2UuanNvbicpXG5cbmNvbnN0IHZlcnNpb24gPSBwYWNrYWdlSnNvbi52ZXJzaW9uXG5cbmNvbnN0IExJTkUgPSAvKD86XnxeKVxccyooPzpleHBvcnRcXHMrKT8oW1xcdy4tXSspKD86XFxzKj1cXHMqP3w6XFxzKz8pKFxccyonKD86XFxcXCd8W14nXSkqJ3xcXHMqXCIoPzpcXFxcXCJ8W15cIl0pKlwifFxccypgKD86XFxcXGB8W15gXSkqYHxbXiNcXHJcXG5dKyk/XFxzKig/OiMuKik/KD86JHwkKS9tZ1xuXG4vLyBQYXJzZXIgc3JjIGludG8gYW4gT2JqZWN0XG5mdW5jdGlvbiBwYXJzZSAoc3JjKSB7XG4gIGNvbnN0IG9iaiA9IHt9XG5cbiAgLy8gQ29udmVydCBidWZmZXIgdG8gc3RyaW5nXG4gIGxldCBsaW5lcyA9IHNyYy50b1N0cmluZygpXG5cbiAgLy8gQ29udmVydCBsaW5lIGJyZWFrcyB0byBzYW1lIGZvcm1hdFxuICBsaW5lcyA9IGxpbmVzLnJlcGxhY2UoL1xcclxcbj8vbWcsICdcXG4nKVxuXG4gIGxldCBtYXRjaFxuICB3aGlsZSAoKG1hdGNoID0gTElORS5leGVjKGxpbmVzKSkgIT0gbnVsbCkge1xuICAgIGNvbnN0IGtleSA9IG1hdGNoWzFdXG5cbiAgICAvLyBEZWZhdWx0IHVuZGVmaW5lZCBvciBudWxsIHRvIGVtcHR5IHN0cmluZ1xuICAgIGxldCB2YWx1ZSA9IChtYXRjaFsyXSB8fCAnJylcblxuICAgIC8vIFJlbW92ZSB3aGl0ZXNwYWNlXG4gICAgdmFsdWUgPSB2YWx1ZS50cmltKClcblxuICAgIC8vIENoZWNrIGlmIGRvdWJsZSBxdW90ZWRcbiAgICBjb25zdCBtYXliZVF1b3RlID0gdmFsdWVbMF1cblxuICAgIC8vIFJlbW92ZSBzdXJyb3VuZGluZyBxdW90ZXNcbiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL14oWydcImBdKShbXFxzXFxTXSopXFwxJC9tZywgJyQyJylcblxuICAgIC8vIEV4cGFuZCBuZXdsaW5lcyBpZiBkb3VibGUgcXVvdGVkXG4gICAgaWYgKG1heWJlUXVvdGUgPT09ICdcIicpIHtcbiAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxcXG4vZywgJ1xcbicpXG4gICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xcXFxyL2csICdcXHInKVxuICAgIH1cblxuICAgIC8vIEFkZCB0byBvYmplY3RcbiAgICBvYmpba2V5XSA9IHZhbHVlXG4gIH1cblxuICByZXR1cm4gb2JqXG59XG5cbmZ1bmN0aW9uIF9sb2cgKG1lc3NhZ2UpIHtcbiAgY29uc29sZS5sb2coYFtkb3RlbnZAJHt2ZXJzaW9ufV1bREVCVUddICR7bWVzc2FnZX1gKVxufVxuXG5mdW5jdGlvbiBfcmVzb2x2ZUhvbWUgKGVudlBhdGgpIHtcbiAgcmV0dXJuIGVudlBhdGhbMF0gPT09ICd+JyA/IHBhdGguam9pbihvcy5ob21lZGlyKCksIGVudlBhdGguc2xpY2UoMSkpIDogZW52UGF0aFxufVxuXG4vLyBQb3B1bGF0ZXMgcHJvY2Vzcy5lbnYgZnJvbSAuZW52IGZpbGVcbmZ1bmN0aW9uIGNvbmZpZyAob3B0aW9ucykge1xuICBsZXQgZG90ZW52UGF0aCA9IHBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCAnLmVudicpXG4gIGxldCBlbmNvZGluZyA9ICd1dGY4J1xuICBjb25zdCBkZWJ1ZyA9IEJvb2xlYW4ob3B0aW9ucyAmJiBvcHRpb25zLmRlYnVnKVxuICBjb25zdCBvdmVycmlkZSA9IEJvb2xlYW4ob3B0aW9ucyAmJiBvcHRpb25zLm92ZXJyaWRlKVxuXG4gIGlmIChvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMucGF0aCAhPSBudWxsKSB7XG4gICAgICBkb3RlbnZQYXRoID0gX3Jlc29sdmVIb21lKG9wdGlvbnMucGF0aClcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuZW5jb2RpbmcgIT0gbnVsbCkge1xuICAgICAgZW5jb2RpbmcgPSBvcHRpb25zLmVuY29kaW5nXG4gICAgfVxuICB9XG5cbiAgdHJ5IHtcbiAgICAvLyBTcGVjaWZ5aW5nIGFuIGVuY29kaW5nIHJldHVybnMgYSBzdHJpbmcgaW5zdGVhZCBvZiBhIGJ1ZmZlclxuICAgIGNvbnN0IHBhcnNlZCA9IERvdGVudk1vZHVsZS5wYXJzZShmcy5yZWFkRmlsZVN5bmMoZG90ZW52UGF0aCwgeyBlbmNvZGluZyB9KSlcblxuICAgIE9iamVjdC5rZXlzKHBhcnNlZCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChwcm9jZXNzLmVudiwga2V5KSkge1xuICAgICAgICBwcm9jZXNzLmVudltrZXldID0gcGFyc2VkW2tleV1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChvdmVycmlkZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHByb2Nlc3MuZW52W2tleV0gPSBwYXJzZWRba2V5XVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRlYnVnKSB7XG4gICAgICAgICAgaWYgKG92ZXJyaWRlID09PSB0cnVlKSB7XG4gICAgICAgICAgICBfbG9nKGBcIiR7a2V5fVwiIGlzIGFscmVhZHkgZGVmaW5lZCBpbiBcXGBwcm9jZXNzLmVudlxcYCBhbmQgV0FTIG92ZXJ3cml0dGVuYClcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgX2xvZyhgXCIke2tleX1cIiBpcyBhbHJlYWR5IGRlZmluZWQgaW4gXFxgcHJvY2Vzcy5lbnZcXGAgYW5kIHdhcyBOT1Qgb3ZlcndyaXR0ZW5gKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG5cbiAgICByZXR1cm4geyBwYXJzZWQgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKGRlYnVnKSB7XG4gICAgICBfbG9nKGBGYWlsZWQgdG8gbG9hZCAke2RvdGVudlBhdGh9ICR7ZS5tZXNzYWdlfWApXG4gICAgfVxuXG4gICAgcmV0dXJuIHsgZXJyb3I6IGUgfVxuICB9XG59XG5cbmNvbnN0IERvdGVudk1vZHVsZSA9IHtcbiAgY29uZmlnLFxuICBwYXJzZVxufVxuXG5tb2R1bGUuZXhwb3J0cy5jb25maWcgPSBEb3RlbnZNb2R1bGUuY29uZmlnXG5tb2R1bGUuZXhwb3J0cy5wYXJzZSA9IERvdGVudk1vZHVsZS5wYXJzZVxubW9kdWxlLmV4cG9ydHMgPSBEb3RlbnZNb2R1bGVcbiIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImNyeXB0b1wiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJmc1wiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJodHRwXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcIm5vZGU6c3RyZWFtXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcIm9zXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcInBhdGhcIik7IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIEV2ZW50c1xuY29uc3QgZXZlbnRzID0gcmVxdWlyZShcIi4vZXZlbnRzLmpzXCIpO1xuY29uc3QgaHR0cCA9IHJlcXVpcmUoXCJodHRwXCIpO1xuY29uc3QgeyBmaW5pc2hlZCB9ID0gcmVxdWlyZSgnbm9kZTpzdHJlYW0nKTtcbmNvbnN0IGVudiA9IHJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygpO1xuY29uc3QgeyByYW5kb21VVUlEIH0gPSByZXF1aXJlKCdjcnlwdG8nKTtcbmNvbnN0IHt1dWlkX3ZhbGlkLCB2YWxpZGF0ZV9wb3N0X2RhdGEgfSAgPSByZXF1aXJlKCcuL3ZhbGlkYXRlcy5qcycpO1xuXG5jb25zdCBQT1JUID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCBudWxsO1xuaWYgKFBPUlQgPT09IG51bGwpIHtcbiAgICBjb25zb2xlLmxvZyhcIlxcbk5vdCBzZXQgcG9ydCBvciBub3QgZm91bmQgLmVudiBmaWxlXCIpO1xuICAgIHByb2Nlc3MuZXhpdCgpO1xufVxuXG4vLyBhcnJheSBkYXRhIGluLW1lbW9yeVxuY29uc3QgdXNlcnMgPSBbXTtcblxuLy8gQXBpIHNlcnZlclxuaHR0cC5jcmVhdGVTZXJ2ZXIoZnVuY3Rpb24ocmVxdWVzdCxyZXNwb25zZSl7XG4gICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKFwiXFxuTWV0aG9kOiBcIisgcmVxdWVzdC5tZXRob2QgKyBcIlxcblJlcXVlc3QgVVJMOiBcIiArIHJlcXVlc3QudXJsICsgXCJcXG5cIik7XG4gICAgICAgIHJlc3BvbnNlLnNldEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAvLyByb3V0ZXIgXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCh0cnVlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZ2V0IGFsbCB1c2VycyAoZ2V0IG9yIGhlYWQgcmVxdWVzdClcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgKHJlcXVlc3QudXJsID09PSAnL2FwaS91c2VycycgJiYgKHJlcXVlc3QubWV0aG9kID09PSBcIkdFVFwiIHx8IHJlcXVlc3QubWV0aG9kID09PSBcIkhFQURcIikpOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldF9hcGlfdXNlcnMocmVxdWVzdCxyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgbmV3IHVzZXIgKHBvc3QgcmVxdWVzdClcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgKHJlcXVlc3QudXJsID09PSAnL2FwaS91c2VycycgJiYgcmVxdWVzdC5tZXRob2QgPT09IFwiUE9TVFwiKTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVfdXNlcnMocmVxdWVzdCxyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdXNlciBmcm9tIHV1aWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgKCAocmVxdWVzdC51cmwubWF0Y2goXCIvYXBpL3VzZXJzL1thLXpBLVowLTlcXC1dKyRcIik/dHJ1ZTpudWxsKSAmJiAocmVxdWVzdC5tZXRob2QgPT09IFwiR0VUXCIgfHwgcmVxdWVzdC5tZXRob2QgPT09IFwiSEVBRFwiKSk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0X3VzZXIgKHJlcXVlc3QscmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWRpdCB1c2VyIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgKCAocmVxdWVzdC51cmwubWF0Y2goXCIvYXBpL3VzZXJzL1thLXpBLVowLTlcXC1dKyRcIik/dHJ1ZTpudWxsKSAmJiByZXF1ZXN0Lm1ldGhvZCA9PT0gXCJQVVRcIik6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdF91c2VyIChyZXF1ZXN0LHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSB1c2VyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICggKHJlcXVlc3QudXJsLm1hdGNoKFwiL2FwaS91c2Vycy9bYS16QS1aMC05XFwtXSskXCIpP3RydWU6bnVsbCkgJiYgcmVxdWVzdC5tZXRob2QgPT09IFwiREVMRVRFXCIpOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZV91c2VyIChyZXF1ZXN0LCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBub3QgZm91bmQgdXJsIGFwaVxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludHNfbm90X2ZvdW5kKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWNhdGNoKGVycikge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLndyaXRlSGVhZChKU09OLnBhcnNlKGVyci5tZXNzYWdlKS5zdGF0dXNDb2RlKTtcbiAgICAgICAgICAgICAgICByZXNwb25zZS53cml0ZShlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuZW5kKFwiXFxuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIC8vIEhhbmRsZXIgZXJyb3IgZm9yIHJlcXVlc3Qgc3RyZWFtIGFuZCByZXNwb25zZSBzdHJlYW1cbiAgICAgICAgZmluaXNoZWQocmVxdWVzdCwgKGVycikgPT4ge1xuICAgICAgICAgICAgaWYoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICAgICAgZmluaXNoZWQocmVzcG9uc2UsIChlcnIpID0+IHtcbiAgICAgICAgICAgIGlmKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG59KS5saXN0ZW4oUE9SVCwgXCIxMjcuMC4wLjFcIiwgKCk9PntcbiAgICBjb25zb2xlLmxvZyhcIlN0YXJ0IGh0dHAgc2VydmVyIVwiKTtcbiAgICBjb25zb2xlLmxvZyhcItCh0LXRgNCy0LXRgCDQvdCw0YfQsNC7INC/0YDQvtGB0LvRg9GI0LjQstCw0L3QuNC1INC30LDQv9GA0L7RgdC+0LIg0L3QsCDQv9C+0YDRgtGDIFwiICsgUE9SVCk7XG59KTtcblxuXG4vLyBoYW5kbGVyIG5vdCBmb3VuZCBlbmRwb2ludCBhcGlcbmNvbnN0IGVuZHBvaW50c19ub3RfZm91bmQgPSAocmVzcG9uc2UpID0+IHtcbiAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShcIlN0YXR1czogNDA0XFxuUmVzcG9uc2U6IGVuZHBvaW50cyBub3QgZm91bmRcXG5cIik7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB7XG4gICAgICAgICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgICAgICAgICBtZXNzYWdlOiBcIlVyaSBhcGkgaHR0cCBub3QgZm91bmRcIlxuICAgICAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yIChKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XG59XG5cbi8vIGdldCBhbGwgdXNlcnMgKGdldCByZXF1ZXN0KVxuY29uc3QgZ2V0X2FwaV91c2VycyA9IChyZXF1ZXN0LHJlc3BvbnNlKSA9PiB7XG4gICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJTdGF0dXM6IDIwMFxcblJlc3BvbnNlOiByZXF1ZXN0IHN1Y2Nlc3NcXG5cIilcbiAgICByZXNwb25zZS5zdGF0dXNDb2RlPTIwMDtcbiAgICByZXNwb25zZS53cml0ZShKU09OLnN0cmluZ2lmeSh1c2VycykgKyBcIlxcblwiKTtcbiAgICByZXNwb25zZS5lbmQoKTtcbn1cblxuLy8gY3JlYXRlIG5ldyB1c2VyIChwb3N0IHJlcXVlc3QpXG5jb25zdCBjcmVhdGVfdXNlcnMgPSAocmVxdWVzdCxyZXNwb25zZSkgPT4ge1xuICAgIGxldCBib2R5PVwiXCI7XG4gICAgcmVxdWVzdC5vbignZGF0YScsIChjaHVuaykgPT4ge1xuICAgICAgICBib2R5ICs9IChjaHVuay50b1N0cmluZygpKTtcbiAgICB9KVxuXG4gICAgcmVxdWVzdC5vbihcImVuZFwiLCAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwcm9wID0gdmFsaWRhdGVfcG9zdF9kYXRhKGJvZHkpO1xuICAgICAgICAgICAgLy8g0JHRgNC+0YHQsNC8INC40YHQutC70Y7Rh9C10L3QuNC1INC10YHQu9C4INC/0L7Qu9GD0YfQtdC90L3Ri9C1IGpzb24g0LTQsNC90L3Ri9C1INC90LUg0L/QvtC70L3QvtGB0YLRjNGOINC30LDQv9C+0LvQvdC10L3Ri1xuICAgICAgICAgICAgaWYoIHByb3Auc3RhdHVzQ29kZSApIHRocm93IG5ldyBFcnJvcihKU09OLnN0cmluZ2lmeShwcm9wKSk7XG4gICAgICAgICAgICBwcm9wLnV1aWQgPSByYW5kb21VVUlEKCk7IFxuICAgICAgICAgICAgdXNlcnMucHVzaChwcm9wKTsgIFxuICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJTdGF0dXM6IDIwMVxcblJlc3BvbnNlOiBjcmVhdGUgdXNlciBzdWNjZXNzXFxuXCIpXG4gICAgICAgICAgICAgICAgcmVzcG9uc2Uud3JpdGVIZWFkKDIwMSk7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2Uud3JpdGUoSlNPTi5zdHJpbmdpZnkocHJvcCkpO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmVuZChcIlxcblwiKTtcbiAgICAgICAgfWNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlLndyaXRlSGVhZChKU09OLnBhcnNlKGVyci5tZXNzYWdlKS5zdGF0dXNDb2RlKTtcbiAgICAgICAgICAgIHJlc3BvbnNlLndyaXRlKGVyci5tZXNzYWdlKTtcbiAgICAgICAgICAgIHJlc3BvbnNlLmVuZCgpO1xuICAgICAgICB9XG4gICAgfSlcbn1cblxuLy9nZXQgdXNlciBcbmNvbnN0IGdldF91c2VyID0gKHJlcXVlc3QsIHJlc3BvbnNlKSA9PiB7XG4gICAgY29uc3QgdXVpZCA9IHJlcXVlc3QudXJsLnNwbGl0KCcvJykuc2xpY2UoLTEpLmpvaW4oKTtcbiAgICBjb25zdCB2YWxpZCA9IHV1aWRfdmFsaWQgKHV1aWQpO1xuICAgIGlmICh2YWxpZCkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSB1c2Vycy5maW5kIChpdGVtID0+IGl0ZW0udXVpZCA9PT0gdXVpZCk7XG4gICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKFwiU3RhdHVzOiAyMDBcXG5SZXNwb25zZTogZ2V0IHVzZXIgc3VjY2Vzc1xcblwiKTtcbiAgICAgICAgICAgIHJlc3BvbnNlLndyaXRlSGVhZCgyMDApO1xuICAgICAgICAgICAgcmVzcG9uc2Uud3JpdGUoSlNPTi5zdHJpbmdpZnkocmVzdWx0KSk7XG4gICAgICAgICAgICByZXNwb25zZS5lbmQoXCJcXG5cIik7XG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKFwiU3RhdHVzOiA0MDRcXG5SZXNwb25zZTogbm90IGZvdW5kIHVzZXJcXG5cIilcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0ge1xuICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IDQwNCwgXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJOb3QgZm91bmQgdXNlcnMgaXMgZ2V0IFVVSURcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IgKEpTT04uc3RyaW5naWZ5KGVycm9yKSk7XG4gICAgICAgIH1cbiAgICB9ZWxzZSB7XG4gICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKFwiU3RhdHVzOiA0MDBcXG5SZXNwb25zZTogaW4gdmFsaWQgdXVpZFxcblwiKVxuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSB7XG4gICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogNDAwLCBcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkdldCBwYXJhbWV0ciB1dWlkIG5vdCB2YWxpZFwiXG4gICAgICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihKU09OLnN0cmluZ2lmeShlcnJvcikpO1xuICAgIH1cbn1cblxuLy8gY2hhbmdlIHVzZXJcbmNvbnN0IGVkaXRfdXNlciA9IChyZXF1ZXN0LCByZXNwb25zZSkgPT4ge1xuICAgIC8vIEdldCBib2R5IHJlcXVlc3RcbiAgICBsZXQgYm9keT1cIlwiO1xuICAgIHJlcXVlc3Qub24oJ2RhdGEnLCAoY2h1bmspID0+IHtcbiAgICAgICAgYm9keSArPSAoY2h1bmsudG9TdHJpbmcoKSk7XG4gICAgfSk7XG4gICAgcmVxdWVzdC5vbihcImVuZFwiLCAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwcm9wID0gdmFsaWRhdGVfcG9zdF9kYXRhKGJvZHkpO1xuICAgICAgICAgICAgLy8g0JHRgNC+0YHQsNC8INC40YHQutC70Y7Rh9C10L3QuNC1INC10YHQu9C4INC/0L7Qu9GD0YfQtdC90L3Ri9C1IGpzb24g0LTQsNC90L3Ri9C1INC90LUg0L/QvtC70L3QvtGB0YLRjNGOINC30LDQv9C+0LvQvdC10L3Ri1xuICAgICAgICAgICAgaWYoIHByb3Auc3RhdHVzQ29kZSApIHRocm93IG5ldyBFcnJvcihKU09OLnN0cmluZ2lmeShwcm9wKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHV1aWQgPSByZXF1ZXN0LnVybC5zcGxpdCgnLycpLnNsaWNlKC0xKS5qb2luKCk7XG4gICAgICAgICAgICBjb25zdCB2YWxpZCA9IHV1aWRfdmFsaWQgKHV1aWQpO1xuXG4gICAgICAgICAgICBpZiAodmFsaWQpIHtcbiAgICAgICAgICAgICAgICAvLyBTZWFyY2ggaXRlbSBmb3IgdXVpZFxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4SXRlbSA9IHVzZXJzLmZpbmRJbmRleChpdGVtID0+IGl0ZW0udXVpZCA9PT0gdXVpZCk7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4SXRlbSAhPSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjaGFuZ2UgdXNlclxuICAgICAgICAgICAgICAgICAgICBwcm9wLnV1aWQgPSB1dWlkO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFuZ2VVc2VyID0gdXNlcnMuc3BsaWNlKGluZGV4SXRlbSwgMSwgcHJvcCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGFuZ2VVc2VyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKFwiU3RhdHVzOiAyMDBcXG5SZXNwb25zZTogY2hhbmdlIHVzZXIgc3VjY2Vzc1xcblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLndyaXRlSGVhZCgyMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2Uud3JpdGUoSlNPTi5zdHJpbmdpZnkocHJvcCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZW5kKFwiXFxuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShcIlN0YXR1czogNDAwXFxuUmVzcG9uc2U6IGNoYW5nZSB1c2VyIGZhaWxcXG5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhdHVzQ29kZVwiOiA0MDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWVzc2FnZVwiOiBcIkNoYW5nZSB1c2VyIGRhdGEgZmFpbCFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihKU09OLnN0cmluZ2lmeShlcnJvcikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShcIlN0YXR1czogNDA0XFxuUmVzcG9uc2U6IG5vdCBmb3VuZCB1c2VyXFxuXCIpXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogNDA0LCBcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiTm90IGZvdW5kIHVzZXJzIGlzIGdldCBVVUlEXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciAoSlNPTi5zdHJpbmdpZnkoZXJyb3IpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJTdGF0dXM6IDQwMFxcblJlc3BvbnNlOiBpbiB2YWxpZCB1dWlkXFxuXCIpXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogNDAwLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiR2V0IHBhcmFtZXRyIHV1aWQgbm90IHZhbGlkXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihKU09OLnN0cmluZ2lmeShlcnJvcikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9Y2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmVzcG9uc2Uud3JpdGVIZWFkKEpTT04ucGFyc2UoZXJyLm1lc3NhZ2UpLnN0YXR1c0NvZGUpO1xuICAgICAgICAgICAgcmVzcG9uc2Uud3JpdGUoZXJyLm1lc3NhZ2UpO1xuICAgICAgICAgICAgcmVzcG9uc2UuZW5kKCk7XG4gICAgICAgIH1cbiAgICB9KVxufVxuXG4vL2RlbGV0ZSB1c2VyXG5jb25zdCBkZWxldGVfdXNlciA9IChyZXF1ZXN0LCByZXNwb25zZSkgPT4ge1xuICAgIGNvbnN0IHV1aWQgPSByZXF1ZXN0LnVybC5zcGxpdCgnLycpLnNsaWNlKC0xKS5qb2luKCk7XG4gICAgY29uc3QgdmFsaWQgPSB1dWlkX3ZhbGlkICh1dWlkKTtcbiAgICBcbiAgICBpZiAodmFsaWQpIHtcbiAgICAgICAgLy8gU2VhcmNoIGl0ZW0gZm9yIHV1aWRcbiAgICAgICAgY29uc3QgaW5kZXhJdGVtID0gdXNlcnMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS51dWlkID09PSB1dWlkKTtcbiAgICAgICAgaWYgKGluZGV4SXRlbSAhPSAtMSkge1xuICAgICAgICAgICAgLy8gZGVsZXRlIHVzZXJcbiAgICAgICAgICAgIGNvbnN0IGRldGVsZVVzZXIgPSB1c2Vycy5zcGxpY2UoaW5kZXhJdGVtLCAxKTtcbiAgICAgICAgICAgIGlmIChkZWxldGVfdXNlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJTdGF0dXM6IDIwNFxcblJlc3BvbnNlOiBkZWxldGUgdXNlciBzdWNjZXNzXFxuXCIpO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLndyaXRlSGVhZCgyMDQpO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmVuZCgpO1xuICAgICAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKFwiU3RhdHVzOiA0MDBcXG5SZXNwb25zZTogZGVsZXRlIHVzZXIgZmFpbFxcblwiKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInN0YXR1c0NvZGVcIjogNDAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJtZXNzYWdlXCI6IFwiRGVsZXRlIHVzZXIgZGF0YSBmYWlsIVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoSlNPTi5zdHJpbmdpZnkoZXJyb3IpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJTdGF0dXM6IDQwNFxcblJlc3BvbnNlOiBub3QgZm91bmQgdXNlclxcblwiKVxuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSB7XG4gICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogNDA0LCBcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIk5vdCBmb3VuZCB1c2VycyBpcyBnZXQgVVVJRFwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgIHRocm93IG5ldyBFcnJvciAoSlNPTi5zdHJpbmdpZnkoZXJyb3IpKTtcbiAgICAgICAgfVxuICAgIH1lbHNlIHtcbiAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJTdGF0dXM6IDQwMFxcblJlc3BvbnNlOiBpbiB2YWxpZCB1dWlkXFxuXCIpXG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IHtcbiAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiA0MDAsIFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiR2V0IHBhcmFtZXRyIHV1aWQgbm90IHZhbGlkXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKEpTT04uc3RyaW5naWZ5KGVycm9yKSk7XG4gICAgfVxufVxuXG4iXSwibmFtZXMiOlsicHJvY2VzcyIsIm9uIiwiZGF0YSIsImV4aXQiLCJjb25zb2xlIiwibG9nIiwibW9kdWxlIiwiZXhwb3J0cyIsInV1aWRfdmFsaWQiLCJmaW5kIiwiaXRlbSIsInRlc3QiLCJ2YWxpZGF0ZV9wb3N0X2RhdGEiLCJib2R5IiwiSlNPTiIsInBhcnNlIiwiYWdlIiwidXNlcm5hbWUiLCJBcnJheSIsImlzQXJyYXkiLCJob2JiaWVzIiwic3Rkb3V0Iiwid3JpdGUiLCJzdGF0dXNDb2RlIiwibWVzc2FnZSIsImUiLCJlcnJvciIsIkVycm9yIiwic3RyaW5naWZ5IiwiZnMiLCJwYXRoIiwib3MiLCJ2ZXJzaW9uIiwiTElORSIsIl9sb2ciLCJEb3RlbnZNb2R1bGUiLCJjb25maWciLCJvcHRpb25zIiwiZG90ZW52UGF0aCIsInJlc29sdmUiLCJjd2QiLCJlbmNvZGluZyIsImRlYnVnIiwiQm9vbGVhbiIsIm92ZXJyaWRlIiwiZW52UGF0aCIsImpvaW4iLCJob21lZGlyIiwic2xpY2UiLCJwYXJzZWQiLCJyZWFkRmlsZVN5bmMiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImVudiIsInNyYyIsIm9iaiIsIm1hdGNoIiwibGluZXMiLCJ0b1N0cmluZyIsInJlcGxhY2UiLCJleGVjIiwidmFsdWUiLCJ0cmltIiwibWF5YmVRdW90ZSIsInJlcXVpcmUiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiaHR0cCIsImZpbmlzaGVkIiwicmFuZG9tVVVJRCIsIlBPUlQiLCJ1c2VycyIsImNyZWF0ZVNlcnZlciIsInJlcXVlc3QiLCJyZXNwb25zZSIsIm1ldGhvZCIsInVybCIsInNldEhlYWRlciIsImdldF9hcGlfdXNlcnMiLCJjcmVhdGVfdXNlcnMiLCJnZXRfdXNlciIsImVkaXRfdXNlciIsImRlbGV0ZV91c2VyIiwiZW5kcG9pbnRzX25vdF9mb3VuZCIsImVyciIsIndyaXRlSGVhZCIsImVuZCIsImxpc3RlbiIsImNodW5rIiwicHJvcCIsInV1aWQiLCJwdXNoIiwic3BsaXQiLCJyZXN1bHQiLCJpbmRleEl0ZW0iLCJmaW5kSW5kZXgiLCJzcGxpY2UiLCJsZW5ndGgiXSwic291cmNlUm9vdCI6IiJ9